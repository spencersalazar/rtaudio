<HTML>
<HEAD>
<TITLE>The RtAudio Home Page</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
<LINK REL="SHORTCUT ICON" HREF="http://www.music.mcgill.ca/~gary/favicon.ico">
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<CENTER>
<a class="qindex" href="index.html">Home</a> &nbsp; <a class="qindex" href="annotated.html">Class/Enum List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </CENTER>
<HR>
<!-- Generated by Doxygen 1.4.4 -->
<h1><a class="anchor" name="playback">Playback</a></h1>In this example, we provide a complete program that demonstrates the use of <a class="el" href="classRtAudio.html">RtAudio</a> for audio playback. Our program produces a two-channel sawtooth waveform for output.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "<a class="code" href="RtAudio_8h.html">RtAudio.h</a>"</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="comment">// Two-channel sawtooth wave generator.</span>
<span class="keywordtype">int</span> saw( <span class="keywordtype">void</span> *outputBuffer, <span class="keywordtype">void</span> *inputBuffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nBufferFrames,
         <span class="keywordtype">double</span> streamTime, <a class="code" href="RtAudio_8h.html#a12">RtAudioStreamStatus</a> status, <span class="keywordtype">void</span> *userData )
{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
  <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span> *) outputBuffer;
  <span class="keywordtype">double</span> *lastValues = (<span class="keywordtype">double</span> *) userData;

  <span class="keywordflow">if</span> ( status )
    std::cout &lt;&lt; <span class="stringliteral">"Stream underflow detected!"</span> &lt;&lt; std::endl;

  <span class="comment">// Write interleaved audio data.</span>
  <span class="keywordflow">for</span> ( i=0; i&lt;nBufferFrames; i++ ) {
    <span class="keywordflow">for</span> ( j=0; j&lt;2; j++ ) {
      *buffer++ = lastValues[j];

      lastValues[j] += 0.005 * (j+1+(j*0.1));
      <span class="keywordflow">if</span> ( lastValues[j] &gt;= 1.0 ) lastValues[j] -= 2.0;
    }
  }

  <span class="keywordflow">return</span> 0;
}

<span class="keywordtype">int</span> main()
{
  <a class="code" href="classRtAudio.html">RtAudio</a> dac;
  <span class="keywordflow">if</span> ( dac.<a class="code" href="classRtAudio.html#a3">getDeviceCount</a>() &lt; 1 ) {
    std::cout &lt;&lt; <span class="stringliteral">"\nNo audio devices found!\n"</span>;
    exit( 0 );
  }

  <a class="code" href="structRtAudio_1_1StreamParameters.html">RtAudio::StreamParameters</a> parameters;
  parameters.<a class="code" href="structRtAudio_1_1StreamParameters.html#o0">deviceId</a> = dac.<a class="code" href="classRtAudio.html#a5">getDefaultOutputDevice</a>();
  parameters.<a class="code" href="structRtAudio_1_1StreamParameters.html#o1">nChannels</a> = 2;
  parameters.<a class="code" href="structRtAudio_1_1StreamParameters.html#o2">firstChannel</a> = 0;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sampleRate = 44100;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bufferFrames = 256; <span class="comment">// 256 sample frames</span>
  <span class="keywordtype">double</span> data[2];

  <span class="keywordflow">try</span> {
    dac.<a class="code" href="classRtAudio.html#a7">openStream</a>( &amp;parameters, NULL, RTAUDIO_FLOAT64,
                    sampleRate, &amp;bufferFrames, &amp;saw, (<span class="keywordtype">void</span> *)&amp;data );
    dac.<a class="code" href="classRtAudio.html#a9">startStream</a>();
  }
  <span class="keywordflow">catch</span> ( <a class="code" href="classRtError.html">RtError</a>&amp; e ) {
    e.<a class="code" href="classRtError.html#a2">printMessage</a>();
    exit( 0 );
  }
  
  <span class="keywordtype">char</span> input;
  std::cout &lt;&lt; <span class="stringliteral">"\nPlaying ... press &lt;enter&gt; to quit.\n"</span>;
  std::cin.get( input );

  <span class="keywordflow">try</span> {
    <span class="comment">// Stop the stream</span>
    dac.<a class="code" href="classRtAudio.html#a10">stopStream</a>();
  }
  <span class="keywordflow">catch</span> (<a class="code" href="classRtError.html">RtError</a>&amp; e) {
    e.<a class="code" href="classRtError.html#a2">printMessage</a>();
  }

  <span class="keywordflow">if</span> ( dac.<a class="code" href="classRtAudio.html#a12">isStreamOpen</a>() ) dac.<a class="code" href="classRtAudio.html#a8">closeStream</a>();

  <span class="keywordflow">return</span> 0;
}
</pre></div><p>
We open the stream in exactly the same way as the previous example (except with a data format change) and specify the address of our callback function <em>"saw()"</em>. The callback function will automatically be invoked when the underlying audio system needs data for output. Note that the callback function is called only when the stream is "running" (between calls to the <a class="el" href="classRtAudio.html#a9">RtAudio::startStream()</a> and <a class="el" href="classRtAudio.html#a10">RtAudio::stopStream()</a> functions). We can also pass a pointer value to the <a class="el" href="classRtAudio.html#a7">RtAudio::openStream()</a> function that is made available in the callback function. In this way, it is possible to gain access to arbitrary data created in our <em>main()</em> function from within the globally defined callback function.<p>
In this example, we stop the stream with an explicit call to <a class="el" href="classRtAudio.html#a10">RtAudio::stopStream()</a>. It is also possible to stop a stream by returning a non-zero value from the callback function. A return value of 1 will cause the stream to finish draining its internal buffers and then halt (equivalent to calling the <a class="el" href="classRtAudio.html#a10">RtAudio::stopStream()</a> function). A return value of 2 will cause the stream to stop immediately (equivalent to calling the <a class="el" href="classRtAudio.html#a11">RtAudio::abortStream()</a> function). <HR>

<table><tr><td><img src="../images/mcgill.gif" width=165></td>
  <td>&copy;2001-2008 Gary P. Scavone, McGill University. All Rights Reserved.<br>Maintained by <a href="http://www.music.mcgill.ca/~gary/">Gary P. Scavone</a>.</td></tr>
</table>

</BODY>
</HTML>
